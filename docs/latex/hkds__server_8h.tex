\doxysection{C\+:/\+Users/stepp/\+Documents/\+Visual Studio 2022/\+Projects/\+C/\+HKDS/\+HKDS/hkds\+\_\+server.h File Reference}
\hypertarget{hkds__server_8h}{}\label{hkds__server_8h}\index{C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/HKDS/HKDS/hkds\_server.h@{C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/HKDS/HKDS/hkds\_server.h}}


This file contains HKDS server definitions.  


{\ttfamily \#include "{}hkds\+\_\+config.\+h"{}}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}}
\begin{DoxyCompactList}\small\item\em Contains the HKDS master key set. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}}
\begin{DoxyCompactList}\small\item\em Contains the HKDS server state. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}}
\begin{DoxyCompactList}\small\item\em Contains the HKDS parallel x8 server state. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a104450eef7daf93a32a2c1f185da911a}{hkds\+\_\+server\+\_\+decrypt\+\_\+message}} (\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}state, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}ciphertext, uint8\+\_\+t \texorpdfstring{$\ast$}{*}plaintext)
\begin{DoxyCompactList}\small\item\em Decrypt a message sent by the client. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API bool \mbox{\hyperlink{hkds__server_8h_ae510a43477a2fe20b955c639130e4dfb}{hkds\+\_\+server\+\_\+decrypt\+\_\+verify\+\_\+message}} (\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}state, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}ciphertext, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}data, size\+\_\+t datalen, uint8\+\_\+t \texorpdfstring{$\ast$}{*}plaintext)
\begin{DoxyCompactList}\small\item\em Verify a ciphertext\textquotesingle{}s integrity with a keyed MAC and decrypt the message. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_af5c8e771489c0ab9e91a7f02a41e049f}{hkds\+\_\+server\+\_\+encrypt\+\_\+token}} (\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}state, uint8\+\_\+t \texorpdfstring{$\ast$}{*}etok)
\begin{DoxyCompactList}\small\item\em Encrypt a secret token key to send to the client. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_ab97232dda4d7cdbcdc0d727765ece657}{hkds\+\_\+server\+\_\+generate\+\_\+edk}} (const uint8\+\_\+t \texorpdfstring{$\ast$}{*}bdk, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}did, uint8\+\_\+t \texorpdfstring{$\ast$}{*}edk)
\begin{DoxyCompactList}\small\item\em Generate the embedded device key (EDK) for a client. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a84d9e06d4428c29beb3be517abebadc7}{hkds\+\_\+server\+\_\+generate\+\_\+mdk}} (bool(\texorpdfstring{$\ast$}{*}rng\+\_\+generate)(uint8\+\_\+t \texorpdfstring{$\ast$}{*}, size\+\_\+t), \mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}mdk, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}kid)
\begin{DoxyCompactList}\small\item\em Generate a master key set. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a181d37c2e1dbabce0bda0af3f9ae89cd}{hkds\+\_\+server\+\_\+initialize\+\_\+state}} (\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}state, \mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}mdk, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}ksn)
\begin{DoxyCompactList}\small\item\em Initialize the HKDS server state. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a3e58f6d3eaf589daca271a285c65849d}{hkds\+\_\+server\+\_\+decrypt\+\_\+message\+\_\+x8}} (\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}state, const uint8\+\_\+t ciphertext\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a04dc7ea0bbae776d018f2644f1ad120a}{HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE}}\mbox{]}, uint8\+\_\+t plaintext\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a04dc7ea0bbae776d018f2644f1ad120a}{HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Decrypt a 2-\/dimensional x8 set of client messages. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a6cd8fac1cce96a191868ff46f54d3f27}{hkds\+\_\+server\+\_\+decrypt\+\_\+verify\+\_\+message\+\_\+x8}} (\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}state, const uint8\+\_\+t ciphertext\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a04dc7ea0bbae776d018f2644f1ad120a}{HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE}}+\mbox{\hyperlink{hkds__config_8h_a151c93388d9100f226d94f468f49ddf1}{HKDS\+\_\+\+TAG\+\_\+\+SIZE}}\mbox{]}, const uint8\+\_\+t data\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a04dc7ea0bbae776d018f2644f1ad120a}{HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE}}\mbox{]}, size\+\_\+t datalen, uint8\+\_\+t plaintext\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a04dc7ea0bbae776d018f2644f1ad120a}{HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE}}\mbox{]}, bool valid\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Verify and decrypt a 2-\/dimensional x8 set of client messages. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_af1f72b792fb058cb9e7c2a9ae48807a8}{hkds\+\_\+server\+\_\+encrypt\+\_\+token\+\_\+x8}} (\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}state, uint8\+\_\+t etok\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a9605d3e7325ea12470eeac0acf19ed24}{HKDS\+\_\+\+STK\+\_\+\+SIZE}}+\mbox{\hyperlink{hkds__config_8h_a151c93388d9100f226d94f468f49ddf1}{HKDS\+\_\+\+TAG\+\_\+\+SIZE}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Encrypt a 2-\/dimensional x8 set of secret token keys. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_a0f11939bbf953fe46ab757366a68c75d}{hkds\+\_\+server\+\_\+generate\+\_\+edk\+\_\+x8}} (const \mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}state, const uint8\+\_\+t did\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_ae7c5f9a1199276040357ff53d9c63a61}{HKDS\+\_\+\+DID\+\_\+\+SIZE}}\mbox{]}, uint8\+\_\+t edk\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_a2560e623e5208ad67c33e64535e0a237}{HKDS\+\_\+\+EDK\+\_\+\+SIZE}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Generate a 2-\/dimensional x8 set of client embedded device keys. \end{DoxyCompactList}\item 
HKDS\+\_\+\+EXPORT\+\_\+\+API void \mbox{\hyperlink{hkds__server_8h_ade811c36835cdc911e2e41cacf871882}{hkds\+\_\+server\+\_\+initialize\+\_\+state\+\_\+x8}} (\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}state, \mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}mdk, const uint8\+\_\+t ksn\mbox{[}\mbox{\hyperlink{hkds__config_8h_a8ff92ab9ce1b32682f248fd091258c7e}{HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH}}\mbox{]}\mbox{[}\mbox{\hyperlink{hkds__config_8h_ae43db7c4b1c63682b673c5e237941215}{HKDS\+\_\+\+KSN\+\_\+\+SIZE}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Initialize a 2-\/dimensional x8 set of server states with client KSNs. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file contains HKDS server definitions. 

This header defines the structures and function prototypes for the HKDS (Hierarchical Key Derivation System) server implementation. The HKDS server is responsible for managing key derivation, token exchange, and secure message processing for client devices. It supports both scalar operations and parallel vectorized operations (using x8 and x64 APIs) for improved performance. 

\doxysubsection{Function Documentation}
\Hypertarget{hkds__server_8h_a104450eef7daf93a32a2c1f185da911a}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_decrypt\_message@{hkds\_server\_decrypt\_message}}
\index{hkds\_server\_decrypt\_message@{hkds\_server\_decrypt\_message}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_decrypt\_message()}{hkds\_server\_decrypt\_message()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a104450eef7daf93a32a2c1f185da911a} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+decrypt\+\_\+message (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{ciphertext}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{plaintext}{}\end{DoxyParamCaption})}



Decrypt a message sent by the client. 

This function decrypts an encrypted message received from a client by generating a transaction key from the server state and XORing it with the ciphertext.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS server state. \\
\hline
{\em ciphertext} & \mbox{[}in\mbox{]} Pointer to the encrypted message array. \\
\hline
{\em plaintext} & \mbox{[}out\mbox{]} Pointer to the buffer where the decrypted message will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_a3e58f6d3eaf589daca271a285c65849d}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_decrypt\_message\_x8@{hkds\_server\_decrypt\_message\_x8}}
\index{hkds\_server\_decrypt\_message\_x8@{hkds\_server\_decrypt\_message\_x8}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_decrypt\_message\_x8()}{hkds\_server\_decrypt\_message\_x8()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a3e58f6d3eaf589daca271a285c65849d} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+decrypt\+\_\+message\+\_\+x8 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{const uint8\+\_\+t}]{ciphertext}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE\mbox{]}, }\item[{uint8\+\_\+t}]{plaintext}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE\mbox{]}}\end{DoxyParamCaption})}



Decrypt a 2-\/dimensional x8 set of client messages. 

This function decrypts an array of 8 client messages in parallel. For each message, a transaction key is generated, and the ciphertext is decrypted by XORing with the key.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS x8 server state. \\
\hline
{\em ciphertext} & \mbox{[}in\mbox{]} A 2D array of 8 encrypted messages. \\
\hline
{\em plaintext} & \mbox{[}out\mbox{]} A 2D array where the decrypted messages will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_ae510a43477a2fe20b955c639130e4dfb}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_decrypt\_verify\_message@{hkds\_server\_decrypt\_verify\_message}}
\index{hkds\_server\_decrypt\_verify\_message@{hkds\_server\_decrypt\_verify\_message}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_decrypt\_verify\_message()}{hkds\_server\_decrypt\_verify\_message()}}
{\footnotesize\ttfamily \label{hkds__server_8h_ae510a43477a2fe20b955c639130e4dfb} 
HKDS\+\_\+\+EXPORT\+\_\+\+API bool hkds\+\_\+server\+\_\+decrypt\+\_\+verify\+\_\+message (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{ciphertext}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{size\+\_\+t}]{datalen}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{plaintext}{}\end{DoxyParamCaption})}



Verify a ciphertext\textquotesingle{}s integrity with a keyed MAC and decrypt the message. 

This function uses KMAC to verify the integrity of an encrypted client message before decrypting it. An optional data array (e.\+g., the originating client\textquotesingle{}s IP address) can be incorporated into the MAC computation. If the MAC verification succeeds, the ciphertext is decrypted (by XORing with the transaction key) to recover the plaintext. On failure, the plaintext is zeroed.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS server state. \\
\hline
{\em ciphertext} & \mbox{[}in\mbox{]} Pointer to the encrypted message array (which includes an appended MAC tag). \\
\hline
{\em data} & \mbox{[}in\mbox{]} Pointer to the additional data array for MAC computation. \\
\hline
{\em datalen} & \mbox{[}in\mbox{]} The length in bytes of the additional data array. \\
\hline
{\em plaintext} & \mbox{[}out\mbox{]} Pointer to the buffer where the decrypted message will be stored. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns true if the MAC verification is successful and decryption occurs; otherwise, false. 
\end{DoxyReturn}
\Hypertarget{hkds__server_8h_a6cd8fac1cce96a191868ff46f54d3f27}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_decrypt\_verify\_message\_x8@{hkds\_server\_decrypt\_verify\_message\_x8}}
\index{hkds\_server\_decrypt\_verify\_message\_x8@{hkds\_server\_decrypt\_verify\_message\_x8}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_decrypt\_verify\_message\_x8()}{hkds\_server\_decrypt\_verify\_message\_x8()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a6cd8fac1cce96a191868ff46f54d3f27} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+decrypt\+\_\+verify\+\_\+message\+\_\+x8 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{const uint8\+\_\+t}]{ciphertext}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE+\+HKDS\+\_\+\+TAG\+\_\+\+SIZE\mbox{]}, }\item[{const uint8\+\_\+t}]{data}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE\mbox{]}, }\item[{size\+\_\+t}]{datalen}{, }\item[{uint8\+\_\+t}]{plaintext}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+MESSAGE\+\_\+\+SIZE\mbox{]}, }\item[{bool}]{valid}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}}\end{DoxyParamCaption})}



Verify and decrypt a 2-\/dimensional x8 set of client messages. 

This function uses KMAC to verify the integrity of 8 client messages in parallel. If the MAC check succeeds, each ciphertext is decrypted and marked as valid; otherwise, the output is zeroed.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS x8 server state. \\
\hline
{\em ciphertext} & \mbox{[}in\mbox{]} A 2D array of 8 encrypted messages (with appended MAC tags). \\
\hline
{\em data} & \mbox{[}in\mbox{]} A 2D array of additional data for MAC computation. \\
\hline
{\em datalen} & \mbox{[}in\mbox{]} The length (in bytes) of the additional data arrays. \\
\hline
{\em plaintext} & \mbox{[}out\mbox{]} A 2D array where the decrypted messages will be stored. \\
\hline
{\em valid} & \mbox{[}out\mbox{]} A boolean array indicating the verification status of each message. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_af5c8e771489c0ab9e91a7f02a41e049f}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_encrypt\_token@{hkds\_server\_encrypt\_token}}
\index{hkds\_server\_encrypt\_token@{hkds\_server\_encrypt\_token}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_encrypt\_token()}{hkds\_server\_encrypt\_token()}}
{\footnotesize\ttfamily \label{hkds__server_8h_af5c8e771489c0ab9e91a7f02a41e049f} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+encrypt\+\_\+token (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{etok}{}\end{DoxyParamCaption})}



Encrypt a secret token key to send to the client. 

This function encrypts the secret token key using a derived encryption key based on a custom token string and the client\textquotesingle{}s embedded device key. A MAC is computed over the encrypted token and appended to the output.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS server state. \\
\hline
{\em etok} & \mbox{[}out\mbox{]} Pointer to the buffer where the encrypted token output key array will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_af1f72b792fb058cb9e7c2a9ae48807a8}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_encrypt\_token\_x8@{hkds\_server\_encrypt\_token\_x8}}
\index{hkds\_server\_encrypt\_token\_x8@{hkds\_server\_encrypt\_token\_x8}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_encrypt\_token\_x8()}{hkds\_server\_encrypt\_token\_x8()}}
{\footnotesize\ttfamily \label{hkds__server_8h_af1f72b792fb058cb9e7c2a9ae48807a8} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+encrypt\+\_\+token\+\_\+x8 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{uint8\+\_\+t}]{etok}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+STK\+\_\+\+SIZE+\+HKDS\+\_\+\+TAG\+\_\+\+SIZE\mbox{]}}\end{DoxyParamCaption})}



Encrypt a 2-\/dimensional x8 set of secret token keys. 

This function encrypts secret token keys for 8 clients in parallel. The output is a 2D array of encrypted token keys with appended MAC tags.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS x8 server state. \\
\hline
{\em etok} & \mbox{[}out\mbox{]} A 2D array where the encrypted token output key arrays will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_ab97232dda4d7cdbcdc0d727765ece657}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_generate\_edk@{hkds\_server\_generate\_edk}}
\index{hkds\_server\_generate\_edk@{hkds\_server\_generate\_edk}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_generate\_edk()}{hkds\_server\_generate\_edk()}}
{\footnotesize\ttfamily \label{hkds__server_8h_ab97232dda4d7cdbcdc0d727765ece657} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+generate\+\_\+edk (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{bdk}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{did}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{edk}{}\end{DoxyParamCaption})}



Generate the embedded device key (EDK) for a client. 

The EDK is derived by concatenating the device\textquotesingle{}s unique identity (DID) with the base derivation key (BDK) and then hashing the result using a SHAKE function. The resulting key is used in subsequent token and key derivation operations.


\begin{DoxyParams}{Parameters}
{\em bdk} & \mbox{[}in\mbox{]} Pointer to the base derivation key array. \\
\hline
{\em did} & \mbox{[}in\mbox{]} Pointer to the device\textquotesingle{}s unique identity string. \\
\hline
{\em edk} & \mbox{[}out\mbox{]} Pointer to the buffer where the embedded device key will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_a0f11939bbf953fe46ab757366a68c75d}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_generate\_edk\_x8@{hkds\_server\_generate\_edk\_x8}}
\index{hkds\_server\_generate\_edk\_x8@{hkds\_server\_generate\_edk\_x8}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_generate\_edk\_x8()}{hkds\_server\_generate\_edk\_x8()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a0f11939bbf953fe46ab757366a68c75d} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+generate\+\_\+edk\+\_\+x8 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{const uint8\+\_\+t}]{did}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+DID\+\_\+\+SIZE\mbox{]}, }\item[{uint8\+\_\+t}]{edk}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+EDK\+\_\+\+SIZE\mbox{]}}\end{DoxyParamCaption})}



Generate a 2-\/dimensional x8 set of client embedded device keys. 

This function generates embedded device keys for 8 clients in parallel, based on each client\textquotesingle{}s device identity and the master key set.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in\mbox{]} Pointer to the HKDS x8 server state. \\
\hline
{\em did} & \mbox{[}in\mbox{]} A 2D array containing the device unique identity strings for 8 clients. \\
\hline
{\em edk} & \mbox{[}out\mbox{]} A 2D array where the embedded device keys will be stored. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_a84d9e06d4428c29beb3be517abebadc7}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_generate\_mdk@{hkds\_server\_generate\_mdk}}
\index{hkds\_server\_generate\_mdk@{hkds\_server\_generate\_mdk}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_generate\_mdk()}{hkds\_server\_generate\_mdk()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a84d9e06d4428c29beb3be517abebadc7} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+generate\+\_\+mdk (\begin{DoxyParamCaption}\item[{bool(\texorpdfstring{$\ast$}{*}}]{rng\+\_\+generate~}{)(uint8\+\_\+t \texorpdfstring{$\ast$}{*}, size\+\_\+t), }\item[{\mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}}]{mdk}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{kid}{}\end{DoxyParamCaption})}



Generate a master key set. 

This function generates a new master key set by invoking a provided random generator function to produce key material. The generated data is split into the base derivation key (BDK) and the secret token key (STK), and the provided key identity (KID) is copied into the master key structure.


\begin{DoxyParams}{Parameters}
{\em rng\+\_\+generate} & \mbox{[}in\mbox{]} Pointer to the random generator function. \\
\hline
{\em mdk} & \mbox{[}out\mbox{]} Pointer to the master key set structure where the keys will be stored. \\
\hline
{\em kid} & \mbox{[}in\mbox{]} Pointer to the master key identity string. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_a181d37c2e1dbabce0bda0af3f9ae89cd}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_initialize\_state@{hkds\_server\_initialize\_state}}
\index{hkds\_server\_initialize\_state@{hkds\_server\_initialize\_state}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_initialize\_state()}{hkds\_server\_initialize\_state()}}
{\footnotesize\ttfamily \label{hkds__server_8h_a181d37c2e1dbabce0bda0af3f9ae89cd} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+initialize\+\_\+state (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__state}{hkds\+\_\+server\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{\mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}}]{mdk}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{ksn}{}\end{DoxyParamCaption})}



Initialize the HKDS server state. 

This function initializes the server state by copying the client\textquotesingle{}s key serial number (KSN), assigning the master key pointer, and initializing the token count and derivation rate.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS server state. \\
\hline
{\em mdk} & \mbox{[}in\mbox{]} Pointer to the master key set. \\
\hline
{\em ksn} & \mbox{[}in\mbox{]} Pointer to the client\textquotesingle{}s key serial number. \\
\hline
\end{DoxyParams}
\Hypertarget{hkds__server_8h_ade811c36835cdc911e2e41cacf871882}\index{hkds\_server.h@{hkds\_server.h}!hkds\_server\_initialize\_state\_x8@{hkds\_server\_initialize\_state\_x8}}
\index{hkds\_server\_initialize\_state\_x8@{hkds\_server\_initialize\_state\_x8}!hkds\_server.h@{hkds\_server.h}}
\doxysubsubsection{\texorpdfstring{hkds\_server\_initialize\_state\_x8()}{hkds\_server\_initialize\_state\_x8()}}
{\footnotesize\ttfamily \label{hkds__server_8h_ade811c36835cdc911e2e41cacf871882} 
HKDS\+\_\+\+EXPORT\+\_\+\+API void hkds\+\_\+server\+\_\+initialize\+\_\+state\+\_\+x8 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhkds__server__x8__state}{hkds\+\_\+server\+\_\+x8\+\_\+state}} \texorpdfstring{$\ast$}{*}}]{state}{, }\item[{\mbox{\hyperlink{structhkds__master__key}{hkds\+\_\+master\+\_\+key}} \texorpdfstring{$\ast$}{*}}]{mdk}{, }\item[{const uint8\+\_\+t}]{ksn}{\mbox{[}\+HKDS\+\_\+\+CACHX8\+\_\+\+DEPTH\mbox{]}\mbox{[}\+HKDS\+\_\+\+KSN\+\_\+\+SIZE\mbox{]}}\end{DoxyParamCaption})}



Initialize a 2-\/dimensional x8 set of server states with client KSNs. 

This function initializes the vectorized server state by copying each client\textquotesingle{}s key serial number (KSN) and assigning the master key set.


\begin{DoxyParams}{Parameters}
{\em state} & \mbox{[}in,out\mbox{]} Pointer to the HKDS x8 server state. \\
\hline
{\em mdk} & \mbox{[}in\mbox{]} Pointer to the master key set. \\
\hline
{\em ksn} & \mbox{[}in\mbox{]} A 2D array containing the client key serial numbers. \\
\hline
\end{DoxyParams}
