<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HKDS: Heirarchal Key Derivation System: C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/HKDS/HKDS/hkds_server.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="hkds_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HKDS: Heirarchal Key Derivation System<span id="projectnumber">&#160;1.0.0.2 (A2)</span>
   </div>
   <div id="projectbrief">A fast post-quantum secure replacement for DUKPT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('hkds__server_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">hkds_server.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file contains HKDS server definitions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="hkds__config_8h_source.html">hkds_config.h</a>&quot;</code><br />
</div>
<p><a href="hkds__server_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhkds__master__key.html">hkds_master_key</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the HKDS master key set.  <a href="structhkds__master__key.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhkds__server__state.html">hkds_server_state</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the HKDS server state.  <a href="structhkds__server__state.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the HKDS parallel x8 server state.  <a href="structhkds__server__x8__state.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a104450eef7daf93a32a2c1f185da911a" id="r_a104450eef7daf93a32a2c1f185da911a"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a104450eef7daf93a32a2c1f185da911a">hkds_server_decrypt_message</a> (<a class="el" href="structhkds__server__state.html">hkds_server_state</a> *state, const uint8_t *ciphertext, uint8_t *plaintext)</td></tr>
<tr class="memdesc:a104450eef7daf93a32a2c1f185da911a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrypt a message sent by the client.  <br /></td></tr>
<tr class="separator:a104450eef7daf93a32a2c1f185da911a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae510a43477a2fe20b955c639130e4dfb" id="r_ae510a43477a2fe20b955c639130e4dfb"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae510a43477a2fe20b955c639130e4dfb">hkds_server_decrypt_verify_message</a> (<a class="el" href="structhkds__server__state.html">hkds_server_state</a> *state, const uint8_t *ciphertext, const uint8_t *data, size_t datalen, uint8_t *plaintext)</td></tr>
<tr class="memdesc:ae510a43477a2fe20b955c639130e4dfb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a ciphertext's integrity with a keyed MAC and decrypt the message.  <br /></td></tr>
<tr class="separator:ae510a43477a2fe20b955c639130e4dfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5c8e771489c0ab9e91a7f02a41e049f" id="r_af5c8e771489c0ab9e91a7f02a41e049f"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af5c8e771489c0ab9e91a7f02a41e049f">hkds_server_encrypt_token</a> (<a class="el" href="structhkds__server__state.html">hkds_server_state</a> *state, uint8_t *etok)</td></tr>
<tr class="memdesc:af5c8e771489c0ab9e91a7f02a41e049f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encrypt a secret token key to send to the client.  <br /></td></tr>
<tr class="separator:af5c8e771489c0ab9e91a7f02a41e049f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab97232dda4d7cdbcdc0d727765ece657" id="r_ab97232dda4d7cdbcdc0d727765ece657"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab97232dda4d7cdbcdc0d727765ece657">hkds_server_generate_edk</a> (const uint8_t *bdk, const uint8_t *did, uint8_t *edk)</td></tr>
<tr class="memdesc:ab97232dda4d7cdbcdc0d727765ece657"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate the embedded device key (EDK) for a client.  <br /></td></tr>
<tr class="separator:ab97232dda4d7cdbcdc0d727765ece657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84d9e06d4428c29beb3be517abebadc7" id="r_a84d9e06d4428c29beb3be517abebadc7"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84d9e06d4428c29beb3be517abebadc7">hkds_server_generate_mdk</a> (bool(*rng_generate)(uint8_t *, size_t), <a class="el" href="structhkds__master__key.html">hkds_master_key</a> *mdk, const uint8_t *kid)</td></tr>
<tr class="memdesc:a84d9e06d4428c29beb3be517abebadc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a master key set.  <br /></td></tr>
<tr class="separator:a84d9e06d4428c29beb3be517abebadc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a181d37c2e1dbabce0bda0af3f9ae89cd" id="r_a181d37c2e1dbabce0bda0af3f9ae89cd"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a181d37c2e1dbabce0bda0af3f9ae89cd">hkds_server_initialize_state</a> (<a class="el" href="structhkds__server__state.html">hkds_server_state</a> *state, <a class="el" href="structhkds__master__key.html">hkds_master_key</a> *mdk, const uint8_t *ksn)</td></tr>
<tr class="memdesc:a181d37c2e1dbabce0bda0af3f9ae89cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the HKDS server state.  <br /></td></tr>
<tr class="separator:a181d37c2e1dbabce0bda0af3f9ae89cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e58f6d3eaf589daca271a285c65849d" id="r_a3e58f6d3eaf589daca271a285c65849d"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3e58f6d3eaf589daca271a285c65849d">hkds_server_decrypt_message_x8</a> (<a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *state, const uint8_t ciphertext[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a04dc7ea0bbae776d018f2644f1ad120a">HKDS_MESSAGE_SIZE</a>], uint8_t plaintext[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a04dc7ea0bbae776d018f2644f1ad120a">HKDS_MESSAGE_SIZE</a>])</td></tr>
<tr class="memdesc:a3e58f6d3eaf589daca271a285c65849d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrypt a 2-dimensional x8 set of client messages.  <br /></td></tr>
<tr class="separator:a3e58f6d3eaf589daca271a285c65849d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cd8fac1cce96a191868ff46f54d3f27" id="r_a6cd8fac1cce96a191868ff46f54d3f27"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6cd8fac1cce96a191868ff46f54d3f27">hkds_server_decrypt_verify_message_x8</a> (<a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *state, const uint8_t ciphertext[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a04dc7ea0bbae776d018f2644f1ad120a">HKDS_MESSAGE_SIZE</a>+<a class="el" href="hkds__config_8h.html#a151c93388d9100f226d94f468f49ddf1">HKDS_TAG_SIZE</a>], const uint8_t data[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a04dc7ea0bbae776d018f2644f1ad120a">HKDS_MESSAGE_SIZE</a>], size_t datalen, uint8_t plaintext[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a04dc7ea0bbae776d018f2644f1ad120a">HKDS_MESSAGE_SIZE</a>], bool valid[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>])</td></tr>
<tr class="memdesc:a6cd8fac1cce96a191868ff46f54d3f27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify and decrypt a 2-dimensional x8 set of client messages.  <br /></td></tr>
<tr class="separator:a6cd8fac1cce96a191868ff46f54d3f27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1f72b792fb058cb9e7c2a9ae48807a8" id="r_af1f72b792fb058cb9e7c2a9ae48807a8"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af1f72b792fb058cb9e7c2a9ae48807a8">hkds_server_encrypt_token_x8</a> (<a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *state, uint8_t etok[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a9605d3e7325ea12470eeac0acf19ed24">HKDS_STK_SIZE</a>+<a class="el" href="hkds__config_8h.html#a151c93388d9100f226d94f468f49ddf1">HKDS_TAG_SIZE</a>])</td></tr>
<tr class="memdesc:af1f72b792fb058cb9e7c2a9ae48807a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encrypt a 2-dimensional x8 set of secret token keys.  <br /></td></tr>
<tr class="separator:af1f72b792fb058cb9e7c2a9ae48807a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f11939bbf953fe46ab757366a68c75d" id="r_a0f11939bbf953fe46ab757366a68c75d"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0f11939bbf953fe46ab757366a68c75d">hkds_server_generate_edk_x8</a> (const <a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *state, const uint8_t did[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#ae7c5f9a1199276040357ff53d9c63a61">HKDS_DID_SIZE</a>], uint8_t edk[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#a2560e623e5208ad67c33e64535e0a237">HKDS_EDK_SIZE</a>])</td></tr>
<tr class="memdesc:a0f11939bbf953fe46ab757366a68c75d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a 2-dimensional x8 set of client embedded device keys.  <br /></td></tr>
<tr class="separator:a0f11939bbf953fe46ab757366a68c75d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade811c36835cdc911e2e41cacf871882" id="r_ade811c36835cdc911e2e41cacf871882"><td class="memItemLeft" align="right" valign="top">HKDS_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ade811c36835cdc911e2e41cacf871882">hkds_server_initialize_state_x8</a> (<a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *state, <a class="el" href="structhkds__master__key.html">hkds_master_key</a> *mdk, const uint8_t ksn[<a class="el" href="hkds__config_8h.html#a8ff92ab9ce1b32682f248fd091258c7e">HKDS_CACHX8_DEPTH</a>][<a class="el" href="hkds__config_8h.html#ae43db7c4b1c63682b673c5e237941215">HKDS_KSN_SIZE</a>])</td></tr>
<tr class="memdesc:ade811c36835cdc911e2e41cacf871882"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a 2-dimensional x8 set of server states with client KSNs.  <br /></td></tr>
<tr class="separator:ade811c36835cdc911e2e41cacf871882"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains HKDS server definitions. </p>
<p>This header defines the structures and function prototypes for the HKDS (Hierarchical Key Derivation System) server implementation. The HKDS server is responsible for managing key derivation, token exchange, and secure message processing for client devices. It supports both scalar operations and parallel vectorized operations (using x8 and x64 APIs) for improved performance. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a104450eef7daf93a32a2c1f185da911a" name="a104450eef7daf93a32a2c1f185da911a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a104450eef7daf93a32a2c1f185da911a">&#9670;&#160;</a></span>hkds_server_decrypt_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_decrypt_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__state.html">hkds_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>ciphertext</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>plaintext</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decrypt a message sent by the client. </p>
<p>This function decrypts an encrypted message received from a client by generating a transaction key from the server state and XORing it with the ciphertext.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS server state. </td></tr>
    <tr><td class="paramname">ciphertext</td><td>[in] Pointer to the encrypted message array. </td></tr>
    <tr><td class="paramname">plaintext</td><td>[out] Pointer to the buffer where the decrypted message will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3e58f6d3eaf589daca271a285c65849d" name="a3e58f6d3eaf589daca271a285c65849d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e58f6d3eaf589daca271a285c65849d">&#9670;&#160;</a></span>hkds_server_decrypt_message_x8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_decrypt_message_x8 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>ciphertext</em></span>[HKDS_CACHX8_DEPTH][HKDS_MESSAGE_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>plaintext</em></span>[HKDS_CACHX8_DEPTH][HKDS_MESSAGE_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decrypt a 2-dimensional x8 set of client messages. </p>
<p>This function decrypts an array of 8 client messages in parallel. For each message, a transaction key is generated, and the ciphertext is decrypted by XORing with the key.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS x8 server state. </td></tr>
    <tr><td class="paramname">ciphertext</td><td>[in] A 2D array of 8 encrypted messages. </td></tr>
    <tr><td class="paramname">plaintext</td><td>[out] A 2D array where the decrypted messages will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae510a43477a2fe20b955c639130e4dfb" name="ae510a43477a2fe20b955c639130e4dfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae510a43477a2fe20b955c639130e4dfb">&#9670;&#160;</a></span>hkds_server_decrypt_verify_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API bool hkds_server_decrypt_verify_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__state.html">hkds_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>ciphertext</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>datalen</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>plaintext</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify a ciphertext's integrity with a keyed MAC and decrypt the message. </p>
<p>This function uses KMAC to verify the integrity of an encrypted client message before decrypting it. An optional data array (e.g., the originating client's IP address) can be incorporated into the MAC computation. If the MAC verification succeeds, the ciphertext is decrypted (by XORing with the transaction key) to recover the plaintext. On failure, the plaintext is zeroed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS server state. </td></tr>
    <tr><td class="paramname">ciphertext</td><td>[in] Pointer to the encrypted message array (which includes an appended MAC tag). </td></tr>
    <tr><td class="paramname">data</td><td>[in] Pointer to the additional data array for MAC computation. </td></tr>
    <tr><td class="paramname">datalen</td><td>[in] The length in bytes of the additional data array. </td></tr>
    <tr><td class="paramname">plaintext</td><td>[out] Pointer to the buffer where the decrypted message will be stored. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns true if the MAC verification is successful and decryption occurs; otherwise, false. </dd></dl>

</div>
</div>
<a id="a6cd8fac1cce96a191868ff46f54d3f27" name="a6cd8fac1cce96a191868ff46f54d3f27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cd8fac1cce96a191868ff46f54d3f27">&#9670;&#160;</a></span>hkds_server_decrypt_verify_message_x8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_decrypt_verify_message_x8 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>ciphertext</em></span>[HKDS_CACHX8_DEPTH][HKDS_MESSAGE_SIZE+HKDS_TAG_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>data</em></span>[HKDS_CACHX8_DEPTH][HKDS_MESSAGE_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>datalen</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>plaintext</em></span>[HKDS_CACHX8_DEPTH][HKDS_MESSAGE_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>valid</em></span>[HKDS_CACHX8_DEPTH]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify and decrypt a 2-dimensional x8 set of client messages. </p>
<p>This function uses KMAC to verify the integrity of 8 client messages in parallel. If the MAC check succeeds, each ciphertext is decrypted and marked as valid; otherwise, the output is zeroed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS x8 server state. </td></tr>
    <tr><td class="paramname">ciphertext</td><td>[in] A 2D array of 8 encrypted messages (with appended MAC tags). </td></tr>
    <tr><td class="paramname">data</td><td>[in] A 2D array of additional data for MAC computation. </td></tr>
    <tr><td class="paramname">datalen</td><td>[in] The length (in bytes) of the additional data arrays. </td></tr>
    <tr><td class="paramname">plaintext</td><td>[out] A 2D array where the decrypted messages will be stored. </td></tr>
    <tr><td class="paramname">valid</td><td>[out] A boolean array indicating the verification status of each message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af5c8e771489c0ab9e91a7f02a41e049f" name="af5c8e771489c0ab9e91a7f02a41e049f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5c8e771489c0ab9e91a7f02a41e049f">&#9670;&#160;</a></span>hkds_server_encrypt_token()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_encrypt_token </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__state.html">hkds_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>etok</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encrypt a secret token key to send to the client. </p>
<p>This function encrypts the secret token key using a derived encryption key based on a custom token string and the client's embedded device key. A MAC is computed over the encrypted token and appended to the output.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS server state. </td></tr>
    <tr><td class="paramname">etok</td><td>[out] Pointer to the buffer where the encrypted token output key array will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af1f72b792fb058cb9e7c2a9ae48807a8" name="af1f72b792fb058cb9e7c2a9ae48807a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1f72b792fb058cb9e7c2a9ae48807a8">&#9670;&#160;</a></span>hkds_server_encrypt_token_x8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_encrypt_token_x8 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>etok</em></span>[HKDS_CACHX8_DEPTH][HKDS_STK_SIZE+HKDS_TAG_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encrypt a 2-dimensional x8 set of secret token keys. </p>
<p>This function encrypts secret token keys for 8 clients in parallel. The output is a 2D array of encrypted token keys with appended MAC tags.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS x8 server state. </td></tr>
    <tr><td class="paramname">etok</td><td>[out] A 2D array where the encrypted token output key arrays will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab97232dda4d7cdbcdc0d727765ece657" name="ab97232dda4d7cdbcdc0d727765ece657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab97232dda4d7cdbcdc0d727765ece657">&#9670;&#160;</a></span>hkds_server_generate_edk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_generate_edk </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>bdk</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>did</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>edk</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generate the embedded device key (EDK) for a client. </p>
<p>The EDK is derived by concatenating the device's unique identity (DID) with the base derivation key (BDK) and then hashing the result using a SHAKE function. The resulting key is used in subsequent token and key derivation operations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bdk</td><td>[in] Pointer to the base derivation key array. </td></tr>
    <tr><td class="paramname">did</td><td>[in] Pointer to the device's unique identity string. </td></tr>
    <tr><td class="paramname">edk</td><td>[out] Pointer to the buffer where the embedded device key will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0f11939bbf953fe46ab757366a68c75d" name="a0f11939bbf953fe46ab757366a68c75d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f11939bbf953fe46ab757366a68c75d">&#9670;&#160;</a></span>hkds_server_generate_edk_x8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_generate_edk_x8 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>did</em></span>[HKDS_CACHX8_DEPTH][HKDS_DID_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>edk</em></span>[HKDS_CACHX8_DEPTH][HKDS_EDK_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generate a 2-dimensional x8 set of client embedded device keys. </p>
<p>This function generates embedded device keys for 8 clients in parallel, based on each client's device identity and the master key set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in] Pointer to the HKDS x8 server state. </td></tr>
    <tr><td class="paramname">did</td><td>[in] A 2D array containing the device unique identity strings for 8 clients. </td></tr>
    <tr><td class="paramname">edk</td><td>[out] A 2D array where the embedded device keys will be stored. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a84d9e06d4428c29beb3be517abebadc7" name="a84d9e06d4428c29beb3be517abebadc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84d9e06d4428c29beb3be517abebadc7">&#9670;&#160;</a></span>hkds_server_generate_mdk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_generate_mdk </td>
          <td>(</td>
          <td class="paramtype">bool(*</td>          <td class="paramname"><span class="paramname"><em>rng_generate&#160;</em></span>)(uint8_t *, size_t), </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhkds__master__key.html">hkds_master_key</a> *</td>          <td class="paramname"><span class="paramname"><em>mdk</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>kid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generate a master key set. </p>
<p>This function generates a new master key set by invoking a provided random generator function to produce key material. The generated data is split into the base derivation key (BDK) and the secret token key (STK), and the provided key identity (KID) is copied into the master key structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rng_generate</td><td>[in] Pointer to the random generator function. </td></tr>
    <tr><td class="paramname">mdk</td><td>[out] Pointer to the master key set structure where the keys will be stored. </td></tr>
    <tr><td class="paramname">kid</td><td>[in] Pointer to the master key identity string. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a181d37c2e1dbabce0bda0af3f9ae89cd" name="a181d37c2e1dbabce0bda0af3f9ae89cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a181d37c2e1dbabce0bda0af3f9ae89cd">&#9670;&#160;</a></span>hkds_server_initialize_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_initialize_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__state.html">hkds_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhkds__master__key.html">hkds_master_key</a> *</td>          <td class="paramname"><span class="paramname"><em>mdk</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>ksn</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the HKDS server state. </p>
<p>This function initializes the server state by copying the client's key serial number (KSN), assigning the master key pointer, and initializing the token count and derivation rate.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS server state. </td></tr>
    <tr><td class="paramname">mdk</td><td>[in] Pointer to the master key set. </td></tr>
    <tr><td class="paramname">ksn</td><td>[in] Pointer to the client's key serial number. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ade811c36835cdc911e2e41cacf871882" name="ade811c36835cdc911e2e41cacf871882"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade811c36835cdc911e2e41cacf871882">&#9670;&#160;</a></span>hkds_server_initialize_state_x8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HKDS_EXPORT_API void hkds_server_initialize_state_x8 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhkds__server__x8__state.html">hkds_server_x8_state</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhkds__master__key.html">hkds_master_key</a> *</td>          <td class="paramname"><span class="paramname"><em>mdk</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>ksn</em></span>[HKDS_CACHX8_DEPTH][HKDS_KSN_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a 2-dimensional x8 set of server states with client KSNs. </p>
<p>This function initializes the vectorized server state by copying each client's key serial number (KSN) and assigning the master key set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>[in,out] Pointer to the HKDS x8 server state. </td></tr>
    <tr><td class="paramname">mdk</td><td>[in] Pointer to the master key set. </td></tr>
    <tr><td class="paramname">ksn</td><td>[in] A 2D array containing the client key serial numbers. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_03d6de1c21003dccaf6658a99f6276cc.html">HKDS</a></li><li class="navelem"><a class="el" href="hkds__server_8h.html">hkds_server.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
